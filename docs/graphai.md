# GraphAIとは

GraphAIとは、TypeScriptで書かれた単機能のAgentと呼ばれるプログラムを、YAMLやJSONファイルに書かれたデータフローグラフの法則に従って順次非同期に実行するプログラムのエンジンです。

LLMやRAGを組み合わせたアプリケーションを作る場合に、組み合わせの数が増えていくと処理の制御が複雑になっていきます。1つの目的のアプリケーションを作る場合はそれに合わせてプログラムを書けば複雑なアプリケーションを作ることも可能ですが、自由に組み合わせて使う場合では、順番の制御などが複雑になっていきます。非同期で効率よく動作するものを作るのはとても困難になります。

GraphAIではエージェントは極力小さく作ることにより、各エージェントはシンプルに保ち、それらの入出力を組み合わせや実行順の制御をGraphAIに任せることより、簡単なプログラムの組み合わせで複雑なアプリケーションを作ることを可能にします。

組み合わせ自体は、YAMLやJSONファイルのデータフローグラフなのでエンジニア以外でも比較的容易にメンテナンスすることが可能です。


## 例

朝起きてから家を出るまでのタスクをプログラムで各例を考えます。左の()内がタスクのid. 右の()は、依存するタスクidとそれぞれの実行にかかる時間。

#### 起きたらすぐするタスク

- (1) コーヒーのお湯をわかす (４分)
- (2) 子供を起こす
  - 3分おきの5回呼ぶと起きる。ただし、3分以内の呼んだり、5分以上間隔が開くと、最初からやり直し
- (3) 朝食をつくる (15分)
- (4) いつも遅れる新聞をとりにいく
  - 5分以上間隔をあけて４回見に行くと、新聞はきている。ただし5分未満で見に行くと 最初からやりなおし

#### 依存タスク

- (5) お湯が湧いたらコーヒーをいれる(1)	(5分)
- (6) 子供が起きたら着替える(2)	(6分)
- (7) 子供が着替えおわったら洗濯機をまわす(6) (13分)
- (8) 朝食ができる && コーヒーができる&& こども着替えおわるの条件を満たすと朝食を食べる(3)(5)(6) (９分)
- (9) 洗濯機終了後、洗濯を干す(7) (5分)
- (10) コーヒーができていて、洗濯が終わっていたらコーヒーを飲み終える(5)(9) (５分)
- (11) 朝食終了 && コーヒーを飲み終えると食器を洗う(10)(8) (４分)
- (12) 朝食終了後、子供が用意する(8) (３分)
- (13) 新聞到着していたら新聞が読む(4) (8分)
- (14) 13までのタスクが全て終わっていたら家出発(1~13)


すべてのタスクは非同期で並列にタスクができるとすると、効率よく14に到達するプログラムを書くことができますか？

GraphAIを使えば、このような複雑な依存のあるタスクも、簡単に制御することが可能となります。


## GraphAIの利用方法

GraphAIを使うには3つの方法があります。

- npmのパッケージでGraphAIをライブラリーとして使う
  - プログラムに組み込んで使う場合はこちらです。
```
yarn add graphai
```

- npmのCLIパッケージでCLIツールとして使う
  - YAMLやJSONでGraphDataを作成し、用意されたエージェントを利用します。
```
npm i -g  @receptron/graphai_cli
```

- GitHubのソースコードを使う
  -  サンプルで用意されているGraphAIを使ったプログラムを実行したり、GraphAI自体を開発する場合に利用します。
```
https://github.com/receptron/graphai.git
```

## 用語

- Agent
  - TypeScriptで書かれたプログラム。特定のタスクを非同期に実行し、入力データを処理して出力データを生成する。たとえば、LLMへの問い合わせ、データベースクエリの実行、外部APIの呼び出し、テキストの処理、計算処理、機械学習モデルの利用など。GraphAIでは、各NodeがAgentを呼び出して実行する。

- GraphData
  - YAMLやJSONで書かれた、GraphAIで実行する内容を記述したデータ。NodeとそのNodeで呼び出すAgent、Node同士の繋がりを定義する。

- Node
  - GraphAIが実行する、Agentを実行する最小単位。
  - Computed Node
     - Agentと関連付けられており、特定のAgent関数を非同期に実行し、入力データを処理して出力データを生成する。この種類のノードは、入力データの依存関係が解決されると実行される。
  - Static Node
    - 初期値が指定された値のみを持ち、外部からの値の注入によって更新される。これは、外部プログラムによってノードの結果を手動で設定するために使用される。


## FAQ

### GraphAIはどのようなエンジンですか？

 GraphAIは非同期データフロー実行エンジンです。

### GraphAIの主な機能は何ですか？

非同期API呼び出しの管理、データ依存関係の管理、タスクの優先順位管理、マップリデュース処理、エラーハンドリング、リトライ、ロギング。

###  GraphAIを使用してどのようなアプリケーションを構築できますか？

エージェント的アプリケーションを構築できます。これは、宣言型データフローグラフで記述されたエージェントワークフローに基づくアプリケーションです。

### エージェント的アプリケーションとは何ですか？

複数の非同期API呼び出しを行い、それらの間でデータの依存関係を管理するアプリケーション。
###  GraphAIでデータフローを記述する際に使用する形式は何ですか？

YAMLまたはJSON形式で記述します。
### データフローグラフのコンポーネントは何ですか？

ノード（計算ノードと静的ノード）、データソース、エージェント、エージェント関数、インラインエージェント関数。
### GraphAIのデータフローグラフにおいて、ノード間の依存関係はどのように指定しますか？

ノードのinputsプロパティで他のノードを参照することで指定します。

### GraphAIで並列実行を制御する方法は？

グラフのconcurrencyプロパティで並列タスクの最大数を指定します。
